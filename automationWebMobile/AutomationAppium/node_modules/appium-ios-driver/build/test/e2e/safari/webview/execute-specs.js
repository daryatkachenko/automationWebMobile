/* globals expect */
'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _desired = require('./desired');

var _desired2 = _interopRequireDefault(_desired);

var _safariSetup = require('../safari-setup');

var _safariSetup2 = _interopRequireDefault(_safariSetup);

var _helpersWebview = require('../../helpers/webview');

var _helpersSession = require('../../helpers/session');

var SCROLL_INTO_VIEW = 'return arguments[0].scrollIntoView(true);';
var GET_RIGHT_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am some page content\') > 0';
var GET_WRONG_INNERHTML = 'return document.body.innerHTML.indexOf(\'I am not some page content\') > 0';
var GET_ELEM_BY_TAGNAME = 'return document.getElementsByTagName(\'a\');';

describe('safari - webview - execute', function () {
  var _this = this;

  this.timeout(_helpersSession.MOCHA_SAFARI_TIMEOUT);

  var driver = (0, _safariSetup2['default'])(this, _desired2['default']).driver;
  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersWebview.loadWebView)(_desired2['default'], driver));

        case 2:
          return context$2$0.abrupt('return', context$2$0.sent);

        case 3:
        case 'end':
          return context$2$0.stop();
      }
    }, null, _this);
  });

  describe('synchronous', function () {
    var _this2 = this;

    it('should bubble up javascript errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should eval javascript', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('return 1'));

          case 2:
            context$3$0.sent.should.be.equal(1);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should not be returning hardcoded results', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('return 1+1'));

          case 2:
            context$3$0.sent.should.be.equal(2);

          case 3:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should return nothing when you don\'t explicitly return', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('1+1'));

          case 2:
            context$3$0.t0 = context$3$0.sent;
            expect(context$3$0.t0).to.not.exist;

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should execute code inside the web view', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute(GET_RIGHT_INNERHTML));

          case 2:
            context$3$0.sent.should.be.ok;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.execute(GET_WRONG_INNERHTML));

          case 5:
            context$3$0.sent.should.not.be.ok;

          case 6:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should convert selenium element arg to webview element', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

          case 2:
            el = context$3$0.sent;
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.execute(SCROLL_INTO_VIEW, [el]));

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should catch stale or undefined element as arg', function callee$2$0() {
      var el;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.findElement('id', 'useragent'));

          case 2:
            el = context$3$0.sent;
            return context$3$0.abrupt('return', driver.execute(SCROLL_INTO_VIEW, [{ 'ELEMENT': el.value + 1 }]).should.beRejected);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });

    it('should be able to return multiple elements from javascript', function callee$2$0() {
      var res;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute(GET_ELEM_BY_TAGNAME));

          case 2:
            res = context$3$0.sent;

            expect(res).to.have.length.above(0);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    it('should pass along non-element arguments', function callee$2$0() {
      var arg;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            arg = 'non-element-argument';
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args[0];', [arg]));

          case 3:
            context$3$0.t0 = arg;
            context$3$0.sent.should.be.equal(context$3$0.t0);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
    it('should handle return values correctly', function callee$2$0() {
      var arg;
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            arg = ['one', 'two', 'three'];
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.execute('var args = Array.prototype.slice.call(arguments, 0); return args;', arg));

          case 3:
            context$3$0.t0 = arg;
            context$3$0.sent.should.eql(context$3$0.t0);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this2);
    });
  });

  describe('asynchronous', function () {
    var _this3 = this;

    it('should bubble up javascript errors', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.execute('\'nan\'--').should.eventually.be.rejected);

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });

    it('should execute async javascript', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.executeAsync('arguments[arguments.length - 1](123);'));

          case 4:
            context$3$0.sent.should.be.equal(123);

          case 5:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });

    it('should timeout when callback is not invoked', function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.asyncScriptTimeout(1000));

          case 2:
            context$3$0.next = 4;
            return _regeneratorRuntime.awrap(driver.executeAsync('return 1 + 2').should.eventually.be.rejected);

          case 4:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this3);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZTJlL3NhZmFyaS93ZWJ2aWV3L2V4ZWN1dGUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozt1QkFDb0IsV0FBVzs7OzsyQkFDYixpQkFBaUI7Ozs7OEJBQ1AsdUJBQXVCOzs4QkFDZCx1QkFBdUI7O0FBRzVELElBQU0sZ0JBQWdCLDhDQUE4QyxDQUFDO0FBQ3JFLElBQU0sbUJBQW1CLDJFQUF5RSxDQUFDO0FBQ25HLElBQU0sbUJBQW1CLCtFQUE2RSxDQUFDO0FBQ3ZHLElBQU0sbUJBQW1CLGlEQUErQyxDQUFDOztBQUV6RSxRQUFRLENBQUMsNEJBQTRCLEVBQUUsWUFBWTs7O0FBQ2pELE1BQUksQ0FBQyxPQUFPLHNDQUFzQixDQUFDOztBQUVuQyxNQUFNLE1BQU0sR0FBRyw4QkFBTSxJQUFJLHVCQUFVLENBQUMsTUFBTSxDQUFDO0FBQzNDLFFBQU0sQ0FBQzs7Ozs7MkNBQWtCLHVEQUFxQixNQUFNLENBQUM7Ozs7Ozs7Ozs7R0FBQSxDQUFDLENBQUM7O0FBRXZELFVBQVEsQ0FBQyxhQUFhLEVBQUUsWUFBWTs7O0FBQ2xDLE1BQUUsQ0FBQyxvQ0FBb0MsRUFBRTs7Ozs7NkNBQ2pDLE1BQU0sQ0FBQyxPQUFPLGFBQVcsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxRQUFROzs7Ozs7O0tBQzlELENBQUMsQ0FBQzs7QUFFSCxNQUFFLENBQUMsd0JBQXdCLEVBQUU7Ozs7OzZDQUNwQixNQUFNLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQzs7OzZCQUFFLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUM7Ozs7Ozs7S0FDckQsQ0FBQyxDQUFDOztBQUVILE1BQUUsQ0FBQywyQ0FBMkMsRUFBRTs7Ozs7NkNBQ3ZDLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDOzs7NkJBQUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQzs7Ozs7OztLQUN2RCxDQUFDLENBQUM7O0FBRUgsTUFB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QUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsUUFBUTs7Ozs7OztLQUN4RSxDQUFDLENBQUM7R0FDSixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMiLCJmaWxlIjoidGVzdC9lMmUvc2FmYXJpL3dlYnZpZXcvZXhlY3V0ZS1zcGVjcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIGdsb2JhbHMgZXhwZWN0ICovXG5pbXBvcnQgZGVzaXJlZCBmcm9tICcuL2Rlc2lyZWQnO1xuaW1wb3J0IHNldHVwIGZyb20gJy4uL3NhZmFyaS1zZXR1cCc7XG5pbXBvcnQgeyBsb2FkV2ViVmlldyB9IGZyb20gJy4uLy4uL2hlbHBlcnMvd2Vidmlldyc7XG5pbXBvcnQgeyBNT0NIQV9TQUZBUklfVElNRU9VVCB9IGZyb20gJy4uLy4uL2hlbHBlcnMvc2Vzc2lvbic7XG5cblxuY29uc3QgU0NST0xMX0lOVE9fVklFVyA9IGByZXR1cm4gYXJndW1lbnRzWzBdLnNjcm9sbEludG9WaWV3KHRydWUpO2A7XG5jb25zdCBHRVRfUklHSFRfSU5ORVJIVE1MID0gYHJldHVybiBkb2N1bWVudC5ib2R5LmlubmVySFRNTC5pbmRleE9mKCdJIGFtIHNvbWUgcGFnZSBjb250ZW50JykgPiAwYDtcbmNvbnN0IEdFVF9XUk9OR19JTk5FUkhUTUwgPSBgcmV0dXJuIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MLmluZGV4T2YoJ0kgYW0gbm90IHNvbWUgcGFnZSBjb250ZW50JykgPiAwYDtcbmNvbnN0IEdFVF9FTEVNX0JZX1RBR05BTUUgPSBgcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdhJyk7YDtcblxuZGVzY3JpYmUoJ3NhZmFyaSAtIHdlYnZpZXcgLSBleGVjdXRlJywgZnVuY3Rpb24gKCkge1xuICB0aGlzLnRpbWVvdXQoTU9DSEFfU0FGQVJJX1RJTUVPVVQpO1xuXG4gIGNvbnN0IGRyaXZlciA9IHNldHVwKHRoaXMsIGRlc2lyZWQpLmRyaXZlcjtcbiAgYmVmb3JlKGFzeW5jICgpID0+IGF3YWl0IGxvYWRXZWJWaWV3KGRlc2lyZWQsIGRyaXZlcikpO1xuXG4gIGRlc2NyaWJlKCdzeW5jaHJvbm91cycsIGZ1bmN0aW9uICgpIHtcbiAgICBpdCgnc2hvdWxkIGJ1YmJsZSB1cCBqYXZhc2NyaXB0IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGRyaXZlci5leGVjdXRlKGAnbmFuJy0tYCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV2YWwgamF2YXNjcmlwdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZSgncmV0dXJuIDEnKSkuc2hvdWxkLmJlLmVxdWFsKDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBub3QgYmUgcmV0dXJuaW5nIGhhcmRjb2RlZCByZXN1bHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCdyZXR1cm4gMSsxJykpLnNob3VsZC5iZS5lcXVhbCgyKTtcbiAgICB9KTtcblxuICAgIGl0KGBzaG91bGQgcmV0dXJuIG5vdGhpbmcgd2hlbiB5b3UgZG9uJ3QgZXhwbGljaXRseSByZXR1cm5gLCBhc3luYyAoKSA9PiB7XG4gICAgICBleHBlY3QoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJzErMScpKS50by5ub3QuZXhpc3Q7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgY29kZSBpbnNpZGUgdGhlIHdlYiB2aWV3JywgYXN5bmMgKCkgPT4ge1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKEdFVF9SSUdIVF9JTk5FUkhUTUwpKS5zaG91bGQuYmUub2s7XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoR0VUX1dST05HX0lOTkVSSFRNTCkpLnNob3VsZC5ub3QuYmUub2s7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNvbnZlcnQgc2VsZW5pdW0gZWxlbWVudCBhcmcgdG8gd2VidmlldyBlbGVtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbGVtZW50KCdpZCcsICd1c2VyYWdlbnQnKTtcbiAgICAgIGF3YWl0IGRyaXZlci5leGVjdXRlKFNDUk9MTF9JTlRPX1ZJRVcsIFtlbF0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYXRjaCBzdGFsZSBvciB1bmRlZmluZWQgZWxlbWVudCBhcyBhcmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZWwgPSBhd2FpdCBkcml2ZXIuZmluZEVsZW1lbnQoJ2lkJywgJ3VzZXJhZ2VudCcpO1xuICAgICAgcmV0dXJuIGRyaXZlci5leGVjdXRlKFNDUk9MTF9JTlRPX1ZJRVcsIFt7J0VMRU1FTlQnOiAoZWwudmFsdWUgKyAxKX1dKS5zaG91bGQuYmVSZWplY3RlZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byByZXR1cm4gbXVsdGlwbGUgZWxlbWVudHMgZnJvbSBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbGV0IHJlcyA9IGF3YWl0IGRyaXZlci5leGVjdXRlKEdFVF9FTEVNX0JZX1RBR05BTUUpO1xuICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5sZW5ndGguYWJvdmUoMCk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBwYXNzIGFsb25nIG5vbi1lbGVtZW50IGFyZ3VtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGxldCBhcmcgPSAnbm9uLWVsZW1lbnQtYXJndW1lbnQnO1xuICAgICAgKGF3YWl0IGRyaXZlci5leGVjdXRlKCd2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMCk7IHJldHVybiBhcmdzWzBdOycsIFthcmddKSkuc2hvdWxkLmJlLmVxdWFsKGFyZyk7XG4gICAgfSk7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmV0dXJuIHZhbHVlcyBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgYXJnID0gWydvbmUnLCAndHdvJywgJ3RocmVlJ107XG4gICAgICAoYXdhaXQgZHJpdmVyLmV4ZWN1dGUoJ3ZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAwKTsgcmV0dXJuIGFyZ3M7JywgYXJnKSkuc2hvdWxkLmVxbChhcmcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXN5bmNocm9ub3VzJywgZnVuY3Rpb24gKCkge1xuICAgIGl0KCdzaG91bGQgYnViYmxlIHVwIGphdmFzY3JpcHQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGUoYCduYW4nLS1gKS5zaG91bGQuZXZlbnR1YWxseS5iZS5yZWplY3RlZDtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBhc3luYyBqYXZhc2NyaXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZHJpdmVyLmFzeW5jU2NyaXB0VGltZW91dCgxMDAwKTtcbiAgICAgIChhd2FpdCBkcml2ZXIuZXhlY3V0ZUFzeW5jKGBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdKDEyMyk7YCkpLnNob3VsZC5iZS5lcXVhbCgxMjMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aW1lb3V0IHdoZW4gY2FsbGJhY2sgaXMgbm90IGludm9rZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBkcml2ZXIuYXN5bmNTY3JpcHRUaW1lb3V0KDEwMDApO1xuICAgICAgYXdhaXQgZHJpdmVyLmV4ZWN1dGVBc3luYyhgcmV0dXJuIDEgKyAyYCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUucmVqZWN0ZWQ7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
