'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _logger = require('./logger');

var _logger2 = _interopRequireDefault(_logger);

var desiredCapConstraints = {
  platformName: {
    presence: true,
    isString: true,
    inclusionCaseInsensitive: ['iOS']
  },
  browserName: {
    isString: true
  },
  app: {
    isString: true
  },

  launchTimeout: {
    // recognize the cap,
    // but validate in the driver#validateDesiredCaps method
  },
  calendarFormat: {
    isString: true
  },
  bundleId: {
    isString: true
  },
  udid: {
    isString: true
  },
  locationServicesEnabled: {
    isBoolean: true
  },
  locationServicesAuthorized: {
    isBoolean: true
  },
  autoAcceptAlerts: {
    isBoolean: true
  },
  autoDismissAlerts: {
    isBoolean: true
  },
  nativeInstrumentsLib: {
    isBoolean: true
  },
  nativeWebTap: {
    isBoolean: true
  },
  safariInitialUrl: {
    isString: true
  },
  safariAllowPopups: {
    isBoolean: true
  },
  safariIgnoreFraudWarning: {
    isBoolean: true
  },
  safariOpenLinksInBackground: {
    isBoolean: true
  },
  keepKeyChains: {
    isBoolean: true
  },
  localizableStringsDir: {
    isString: true
  },
  processArguments: {
    // recognize the cap,
    // but validate in the driver#validateDesiredCaps method
  },
  interKeyDelay: {
    isNumber: true
  },
  showIOSLog: {
    isBoolean: true
  },
  sendKeyStrategy: {
    isString: true,
    inclusion: ['oneByOne', 'grouped', 'setValue']
  },
  screenshotWaitTimeout: {
    isNumber: true
  },
  waitForAppScript: {
    isString: true
  },
  webviewConnectRetries: {
    isNumber: true
  },
  appName: {
    isString: true
  },
  clearSystemFiles: {
    isBoolean: true
  },
  customSSLCert: {
    isString: true
  },
  webkitResponseTimeout: {
    isNumber: true
  }
};

function desiredCapValidation(caps) {
  // make sure that the capabilities have one of `app` or `bundleId`
  if ((caps.browserName || '').toLowerCase() !== 'safari' && !caps.app && !caps.bundleId) {
    var msg = 'The desired capabilities must include either an app or a bundleId for iOS';
    _logger2['default'].errorAndThrow(msg);
  }

  // `launchTimeout` is more complex than the validators can easily handle
  // and too specific for a generalized validator of its own
  if (caps.launchTimeout) {
    // it can be a number, a JSON string, or an object
    var msg = 'launchTimeout must be a number, object, or string JSON object';
    if (!_lodash2['default'].isNumber(caps.launchTimeout)) {
      if (_lodash2['default'].isString(caps.launchTimeout)) {
        // if this is a string, it must be a JSON string
        try {
          // change `launchTimeout` to an object
          caps.launchTimeout = JSON.parse(caps.launchTimeout);
        } catch (err) {
          // it was a string, but not something parsable as JSON
          _logger2['default'].errorAndThrow(msg);
        }
      }
      if (!_lodash2['default'].isObject(caps.launchTimeout)) {
        _logger2['default'].errorAndThrow(msg);
      }
    }
  }

  // `processArguments` is more complex as it can be a string
  // or a hash
  if (caps.processArguments) {
    if (_lodash2['default'].isString(caps.processArguments)) {
      try {
        // try to parse the string as JSON
        caps.processArguments = JSON.parse(caps.processArguments);
      } catch (ign) {
        // if we cannot parse, just leave as a string
      }
    } else if (!_lodash2['default'].isObject(caps.processArguments)) {
        _logger2['default'].errorAndThrow('processArguments must be a string, object, or a string JSON object');
      }
  }

  // finally, return true since the superclass check passed, as did this
  return true;
}

exports.desiredCapConstraints = desiredCapConstraints;
exports.desiredCapValidation = desiredCapValidation;
exports['default'] = desiredCapConstraints;
//# sourceMappingURL=data:application/json;charset=utf8;base64,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USxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRTtBQUNuQyxVQUFJLG9CQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUU7O0FBRWxDLFlBQUk7O0FBRUYsY0FBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUNyRCxDQUFDLE9BQU8sR0FBRyxFQUFFOztBQUVaLDhCQUFPLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUMzQjtPQUNGO0FBQ0QsVUFBSSxDQUFDLG9CQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUU7QUFDbkMsNEJBQU8sYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDO09BQzNCO0tBQ0Y7R0FDRjs7OztBQUlELE1BQUksSUFBSSxDQUFDLGdCQUFnQixFQUFFO0FBQ3pCLFFBQUksb0JBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO0FBQ3JDLFVBQUk7O0FBRUYsWUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLENBQUM7T0FDM0QsQ0FBQyxPQUFPLEdBQUcsRUFBRTs7T0FFYjtLQUNGLE1BQU0sSUFBSSxDQUFDLG9CQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRTtBQUM3Qyw0QkFBTyxhQUFhLENBQUMsb0VBQW9FLENBQUMsQ0FBQztPQUM1RjtHQUNGOzs7QUFHRCxTQUFPLElBQUksQ0FBQztDQUNiOztRQUVRLHFCQUFxQixHQUFyQixxQkFBcUI7UUFBRSxvQkFBb0IsR0FBcEIsb0JBQW9CO3FCQUNyQyxxQkFBcUIiLCJmaWxlIjoibGliL2Rlc2lyZWQtY2Fwcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nZ2VyIGZyb20gJy4vbG9nZ2VyJztcblxuXG5jb25zdCBkZXNpcmVkQ2FwQ29uc3RyYWludHMgPSB7XG4gIHBsYXRmb3JtTmFtZToge1xuICAgIHByZXNlbmNlOiB0cnVlLFxuICAgIGlzU3RyaW5nOiB0cnVlLFxuICAgIGluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZTogWydpT1MnXVxuICB9LFxuICBicm93c2VyTmFtZToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGFwcDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG5cbiAgbGF1bmNoVGltZW91dDoge1xuICAgIC8vIHJlY29nbml6ZSB0aGUgY2FwLFxuICAgIC8vIGJ1dCB2YWxpZGF0ZSBpbiB0aGUgZHJpdmVyI3ZhbGlkYXRlRGVzaXJlZENhcHMgbWV0aG9kXG4gIH0sXG4gIGNhbGVuZGFyRm9ybWF0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgYnVuZGxlSWQ6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICB1ZGlkOiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgbG9jYXRpb25TZXJ2aWNlc0VuYWJsZWQ6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgbG9jYXRpb25TZXJ2aWNlc0F1dGhvcml6ZWQ6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgYXV0b0FjY2VwdEFsZXJ0czoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBhdXRvRGlzbWlzc0FsZXJ0czoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBuYXRpdmVJbnN0cnVtZW50c0xpYjoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBuYXRpdmVXZWJUYXA6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2FmYXJpSW5pdGlhbFVybDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUFsbG93UG9wdXBzOiB7XG4gICAgaXNCb29sZWFuOiB0cnVlXG4gIH0sXG4gIHNhZmFyaUlnbm9yZUZyYXVkV2FybmluZzoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBzYWZhcmlPcGVuTGlua3NJbkJhY2tncm91bmQ6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAga2VlcEtleUNoYWluczoge1xuICAgIGlzQm9vbGVhbjogdHJ1ZVxuICB9LFxuICBsb2NhbGl6YWJsZVN0cmluZ3NEaXI6IHtcbiAgICBpc1N0cmluZzogdHJ1ZVxuICB9LFxuICBwcm9jZXNzQXJndW1lbnRzOiB7XG4gICAgLy8gcmVjb2duaXplIHRoZSBjYXAsXG4gICAgLy8gYnV0IHZhbGlkYXRlIGluIHRoZSBkcml2ZXIjdmFsaWRhdGVEZXNpcmVkQ2FwcyBtZXRob2RcbiAgfSxcbiAgaW50ZXJLZXlEZWxheToge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG4gIHNob3dJT1NMb2c6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgc2VuZEtleVN0cmF0ZWd5OiB7XG4gICAgaXNTdHJpbmc6IHRydWUsXG4gICAgaW5jbHVzaW9uOiBbJ29uZUJ5T25lJywgJ2dyb3VwZWQnLCAnc2V0VmFsdWUnXVxuICB9LFxuICBzY3JlZW5zaG90V2FpdFRpbWVvdXQ6IHtcbiAgICBpc051bWJlcjogdHJ1ZVxuICB9LFxuICB3YWl0Rm9yQXBwU2NyaXB0OiB7XG4gICAgaXNTdHJpbmc6IHRydWVcbiAgfSxcbiAgd2Vidmlld0Nvbm5lY3RSZXRyaWVzOiB7XG4gICAgaXNOdW1iZXI6IHRydWVcbiAgfSxcbiAgYXBwTmFtZToge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIGNsZWFyU3lzdGVtRmlsZXM6IHtcbiAgICBpc0Jvb2xlYW46IHRydWVcbiAgfSxcbiAgY3VzdG9tU1NMQ2VydDoge1xuICAgIGlzU3RyaW5nOiB0cnVlXG4gIH0sXG4gIHdlYmtpdFJlc3BvbnNlVGltZW91dDoge1xuICAgIGlzTnVtYmVyOiB0cnVlXG4gIH0sXG59O1xuXG5mdW5jdGlvbiBkZXNpcmVkQ2FwVmFsaWRhdGlvbiAoY2Fwcykge1xuICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgY2FwYWJpbGl0aWVzIGhhdmUgb25lIG9mIGBhcHBgIG9yIGBidW5kbGVJZGBcbiAgaWYgKChjYXBzLmJyb3dzZXJOYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpICE9PSAnc2FmYXJpJyAmJlxuICAgICAgIWNhcHMuYXBwICYmICEgY2Fwcy5idW5kbGVJZCkge1xuICAgIGxldCBtc2cgPSAnVGhlIGRlc2lyZWQgY2FwYWJpbGl0aWVzIG11c3QgaW5jbHVkZSBlaXRoZXIgYW4gYXBwIG9yIGEgYnVuZGxlSWQgZm9yIGlPUyc7XG4gICAgbG9nZ2VyLmVycm9yQW5kVGhyb3cobXNnKTtcbiAgfVxuXG4gIC8vIGBsYXVuY2hUaW1lb3V0YCBpcyBtb3JlIGNvbXBsZXggdGhhbiB0aGUgdmFsaWRhdG9ycyBjYW4gZWFzaWx5IGhhbmRsZVxuICAvLyBhbmQgdG9vIHNwZWNpZmljIGZvciBhIGdlbmVyYWxpemVkIHZhbGlkYXRvciBvZiBpdHMgb3duXG4gIGlmIChjYXBzLmxhdW5jaFRpbWVvdXQpIHtcbiAgICAvLyBpdCBjYW4gYmUgYSBudW1iZXIsIGEgSlNPTiBzdHJpbmcsIG9yIGFuIG9iamVjdFxuICAgIGxldCBtc2cgPSAnbGF1bmNoVGltZW91dCBtdXN0IGJlIGEgbnVtYmVyLCBvYmplY3QsIG9yIHN0cmluZyBKU09OIG9iamVjdCc7XG4gICAgaWYgKCFfLmlzTnVtYmVyKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgIGlmIChfLmlzU3RyaW5nKGNhcHMubGF1bmNoVGltZW91dCkpIHtcbiAgICAgICAgLy8gaWYgdGhpcyBpcyBhIHN0cmluZywgaXQgbXVzdCBiZSBhIEpTT04gc3RyaW5nXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gY2hhbmdlIGBsYXVuY2hUaW1lb3V0YCB0byBhbiBvYmplY3RcbiAgICAgICAgICBjYXBzLmxhdW5jaFRpbWVvdXQgPSBKU09OLnBhcnNlKGNhcHMubGF1bmNoVGltZW91dCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8vIGl0IHdhcyBhIHN0cmluZywgYnV0IG5vdCBzb21ldGhpbmcgcGFyc2FibGUgYXMgSlNPTlxuICAgICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghXy5pc09iamVjdChjYXBzLmxhdW5jaFRpbWVvdXQpKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KG1zZyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gYHByb2Nlc3NBcmd1bWVudHNgIGlzIG1vcmUgY29tcGxleCBhcyBpdCBjYW4gYmUgYSBzdHJpbmdcbiAgLy8gb3IgYSBoYXNoXG4gIGlmIChjYXBzLnByb2Nlc3NBcmd1bWVudHMpIHtcbiAgICBpZiAoXy5pc1N0cmluZyhjYXBzLnByb2Nlc3NBcmd1bWVudHMpKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyB0cnkgdG8gcGFyc2UgdGhlIHN0cmluZyBhcyBKU09OXG4gICAgICAgIGNhcHMucHJvY2Vzc0FyZ3VtZW50cyA9IEpTT04ucGFyc2UoY2Fwcy5wcm9jZXNzQXJndW1lbnRzKTtcbiAgICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgICAvLyBpZiB3ZSBjYW5ub3QgcGFyc2UsIGp1c3QgbGVhdmUgYXMgYSBzdHJpbmdcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFfLmlzT2JqZWN0KGNhcHMucHJvY2Vzc0FyZ3VtZW50cykpIHtcbiAgICAgIGxvZ2dlci5lcnJvckFuZFRocm93KCdwcm9jZXNzQXJndW1lbnRzIG11c3QgYmUgYSBzdHJpbmcsIG9iamVjdCwgb3IgYSBzdHJpbmcgSlNPTiBvYmplY3QnKTtcbiAgICB9XG4gIH1cblxuICAvLyBmaW5hbGx5LCByZXR1cm4gdHJ1ZSBzaW5jZSB0aGUgc3VwZXJjbGFzcyBjaGVjayBwYXNzZWQsIGFzIGRpZCB0aGlzXG4gIHJldHVybiB0cnVlO1xufVxuXG5leHBvcnQgeyBkZXNpcmVkQ2FwQ29uc3RyYWludHMsIGRlc2lyZWRDYXBWYWxpZGF0aW9uIH07XG5leHBvcnQgZGVmYXVsdCBkZXNpcmVkQ2FwQ29uc3RyYWludHM7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uIn0=
